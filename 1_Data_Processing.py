# -*- coding: utf-8 -*-
"""final_data_processing.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Xf0am_VjrE_bEcywdPBBcr3PYuTDFAFl
"""

import pickle
import pandas as pd
from sklearn.model_selection import train_test_split

data = pd.read_csv('NSDUH_2017_Tab.tsv', sep='\t')
print(f'users: {data.shape[0]}  features: {data.shape[1]}')

#substance dataframe - columns from start to KM
subs_df = data.iloc[:, :data.columns.get_loc("STMNORXFG")]  #rows, col
print(f'rows: {subs_df.shape[0]} columns: {subs_df.shape[1]}')

#health dataframe - columns from BJQ to CNS
hlth_df = data.iloc[:, data.columns.get_loc("PREGNANT"):data.columns.get_loc("YOTMTHLP")]
print(f'rows: {hlth_df.shape[0]} columns: {hlth_df.shape[1]}')

#demographic dataframe - columns from CRH to CXF
demo_df = data.iloc[:, data.columns.get_loc("AGE2"):data.columns.get_loc("POVERTY3")]
print(f'rows: {demo_df.shape[0]} columns: {demo_df.shape[1]}')

#90% for training 10% for testing
subs_train, subs_test, hlth_train, hlth_test, demo_train, demo_test = train_test_split(subs_df, hlth_df, demo_df, test_size=0.1, random_state=1)
#11.1111% for validation set and remaining for train set
subs_train, subs_val, hlth_train, hlth_val, demo_train, demo_val = train_test_split(subs_train, hlth_train, demo_train, test_size=0.111111, random_state=1)

with open('data.pickle', 'wb') as handle:
    pickle.dump([subs_train, subs_test, subs_val, hlth_train, hlth_test, hlth_val, demo_train, demo_test, demo_val], handle, protocol=pickle.HIGHEST_PROTOCOL)